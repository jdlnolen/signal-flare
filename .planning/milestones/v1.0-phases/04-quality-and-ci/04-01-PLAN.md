---
phase: 04-quality-and-ci
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vitest.config.ts
  - eslint.config.js
  - .prettierrc
  - src/config.ts
  - src/slack/client.ts
  - src/slack/messages.ts
  - src/slack/poller.ts
  - src/tools/ask-human.ts
  - src/hooks/router.ts
  - src/hooks/stop.ts
  - src/hooks/post-tool-failure.ts
  - src/hooks/permission.ts
  - src/hooks/watcher.ts
  - src/hook-handler.ts
  - src/server.ts
  - src/cli.ts
  - src/types.ts
  - src/wizard/prompts.ts
  - src/wizard/validator.ts
  - src/wizard/config-writer.ts
  - src/commands/setup.ts
  - src/commands/status.ts
  - src/commands/test.ts
autonomous: true
requirements:
  - PKG-06
  - PKG-07

must_haves:
  truths:
    - "Running `npx eslint src` passes with zero errors on all existing source files"
    - "Running `npx prettier --check src` passes on all existing source files"
    - "Running `npx vitest run` executes successfully (even with zero tests)"
    - "Running `npx vitest run --coverage` reports coverage with v8 provider and enforces thresholds"
    - "package.json has lint, lint:fix, format, format:check, and coverage scripts"
  artifacts:
    - path: "vitest.config.ts"
      provides: "Vitest configuration with v8 coverage, thresholds, and entry-point exclusions"
      contains: "thresholds"
    - path: "eslint.config.js"
      provides: "ESLint 9 flat config with typescript-eslint, prettier, and no-console rule"
      contains: "no-console"
    - path: ".prettierrc"
      provides: "Prettier configuration"
      contains: "singleQuote"
    - path: "package.json"
      provides: "Updated scripts and devDependencies"
      contains: "coverage"
  key_links:
    - from: "eslint.config.js"
      to: "src/**/*.ts"
      via: "no-console rule enforcement"
      pattern: "no-console.*error.*allow.*error.*warn"
    - from: "vitest.config.ts"
      to: "src/**/*.ts"
      via: "coverage include/exclude patterns"
      pattern: "include.*src/\\*\\*/\\*.ts"
---

<objective>
Install all quality tooling (ESLint 9, Prettier, @vitest/coverage-v8), create configuration files (vitest.config.ts, eslint.config.js, .prettierrc), add package.json scripts, and fix all existing source files to pass lint and format checks.

Purpose: Establish the clean baseline that all test-writing plans depend on. Per locked decision, lint fix happens first as a separate concern before any tests are written.
Output: Configured tooling, passing lint/format, ready for test authoring.
</objective>

<execution_context>
@/Users/jdlnolen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jdlnolen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-quality-and-ci/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dev dependencies and create configuration files</name>
  <files>
    package.json
    vitest.config.ts
    eslint.config.js
    .prettierrc
  </files>
  <action>
Install all required dev dependencies in a single command:
```bash
npm install -D @vitest/coverage-v8 eslint typescript-eslint eslint-config-prettier prettier
```

Create `vitest.config.ts` at project root:
- Provider: v8
- Include: `src/**/*.ts`
- Exclude from coverage: `src/**/*.test.ts`, `src/cli.ts`, `src/server.ts`, `src/hook-handler.ts`, `src/hooks/watcher.ts`, `src/commands/**/*.ts`, `src/wizard/**/*.ts`
- Thresholds: start at 85% for lines/functions/branches/statements (per research recommendation — adjust to 90% once actual coverage is measured; CONTEXT.md allows Claude discretion here)
- Reporter: `['text', 'json', 'html']`
- Test reporters: use `['dot', 'github-actions']` when `GITHUB_ACTIONS` env is set, otherwise `['default']`

Create `eslint.config.js` using ESLint 9 flat config (NOT `.mjs` — project has `"type": "module"`):
- Import `@eslint/js` recommended, `typescript-eslint` recommended, `eslint-config-prettier`
- Add `no-console: ['error', { allow: ['error', 'warn'] }]` for `src/**/*.ts` files
- Override `no-console: 'off'` for `src/cli.ts` and `src/commands/**/*.ts`
- Also override `no-console: 'off'` for `src/wizard/**/*.ts` (wizard files use console.log per Phase 3 decision)
- Relax `@typescript-eslint/no-explicit-any: 'off'` for `src/**/*.test.ts`
- Add global ignores for `dist/`, `node_modules/`, `coverage/`

Create `.prettierrc`:
```json
{
  "singleQuote": false,
  "semi": true,
  "printWidth": 100,
  "trailingComma": "es5"
}
```

Add scripts to `package.json`:
- `"lint": "eslint src"`
- `"lint:fix": "eslint src --fix"`
- `"format": "prettier --write src"`
- `"format:check": "prettier --check src"`
- `"coverage": "vitest run --coverage"`

Keep existing scripts (`build`, `dev`, `test`, `typecheck`) unchanged.
  </action>
  <verify>
Run `npm run lint -- --max-warnings=0 2>&1 | tail -5` — check it runs (may have errors at this stage, that's OK).
Run `npx vitest run 2>&1 | tail -3` — confirm vitest runs and exits cleanly (no tests yet is fine).
Verify `vitest.config.ts`, `eslint.config.js`, `.prettierrc` all exist.
  </verify>
  <done>All config files exist, all package.json scripts work, dependencies installed.</done>
</task>

<task type="auto">
  <name>Task 2: Fix all existing source files to pass lint and format</name>
  <files>
    src/config.ts
    src/slack/client.ts
    src/slack/messages.ts
    src/slack/poller.ts
    src/tools/ask-human.ts
    src/hooks/router.ts
    src/hooks/stop.ts
    src/hooks/post-tool-failure.ts
    src/hooks/permission.ts
    src/hooks/watcher.ts
    src/hook-handler.ts
    src/server.ts
    src/cli.ts
    src/types.ts
    src/wizard/prompts.ts
    src/wizard/validator.ts
    src/wizard/config-writer.ts
    src/commands/setup.ts
    src/commands/status.ts
    src/commands/test.ts
  </files>
  <action>
Run Prettier first to auto-fix formatting:
```bash
npx prettier --write src
```

Then run ESLint with auto-fix:
```bash
npx eslint src --fix
```

After auto-fix, check for remaining errors:
```bash
npx eslint src
```

For any remaining errors that `--fix` cannot resolve automatically:
- `no-console` violations: Change `console.log` to `console.error` in MCP server code (NOT in cli.ts, commands/, wizard/ — those are exempt)
- `@typescript-eslint/no-unused-vars`: Remove or prefix with underscore (`_`)
- `@typescript-eslint/no-explicit-any`: Replace with proper types where straightforward; if complex, add `// eslint-disable-next-line` with brief justification
- Any other typescript-eslint recommended rule violations: Fix manually

IMPORTANT: This is a lint-fix-only task. Do NOT change any runtime behavior. Only formatting and lint compliance changes. Per locked decision, this should be a separate commit from test code.
  </action>
  <verify>
Run `npm run lint` — must exit 0 with zero errors.
Run `npm run format:check` — must exit 0 (all files formatted).
Run `npm run typecheck` — must still pass (lint fixes didn't break types).
Run `npm run build` — must still pass (lint fixes didn't break build).
  </verify>
  <done>All source files pass ESLint and Prettier checks. `npm run lint` and `npm run format:check` both exit 0. Build and typecheck still pass.</done>
</task>

</tasks>

<verification>
1. `npm run lint` exits 0
2. `npm run format:check` exits 0
3. `npm run typecheck` exits 0
4. `npm run build` exits 0
5. `npx vitest run` executes without configuration errors
6. `npx vitest run --coverage` reports v8 coverage (even if 0 tests)
7. `vitest.config.ts`, `eslint.config.js`, `.prettierrc` all exist at project root
</verification>

<success_criteria>
All quality tooling is installed and configured. Every existing source file passes both ESLint and Prettier. The project builds and typechecks cleanly. Vitest is ready to run tests with coverage collection.
</success_criteria>

<output>
After completion, create `.planning/phases/04-quality-and-ci/04-01-SUMMARY.md`
</output>
